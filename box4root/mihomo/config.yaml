# æ­¤ä¸ºç²¾ç®€é…ç½®ï¼Œå¦‚éœ€æ›´ä¸ºè¯¦ç»†çš„é…ç½®ï¼Œå¯å‚è€ƒ https://wiki.metacubex.one/config
# å¦‚ä¸ä¼šé…ç½®ï¼Œä¹Ÿå¯è‡ªè¡Œå¯»æ‰¾æ‡’äººé…ç½®ï¼Œä¾‹å¦‚(Surfing æ¨¡å—é…ç½®)ï¼šhttps://raw.githubusercontent.com/GitMetaio/Surfing/refs/heads/main/box_bll/clash/config.yaml
# enable model auto update, the default is false
#lgbm-auto-update: true
# model auto update interval, the default is 72 (hours)
#lgbm-update-interval: 72
# model update url
#lgbm-url: "https://github.com/vernesong/mihomo/releases/download/LightGBM-Model/Model.bin"
#strategy: sticky-sessions










# æŒç®¡æ—¶é—´çš„***
updatetime: &Time 86400








#é”šç‚¹è®¢é˜…ç±»å‹http,å…·æœ‰å¥åº·æ£€æŸ¥,(proxy-providers)
#åœ¨é˜…åå³ç„šçš„å¤§è¶‹åŠ¿ä¸‹éš¾æœ‰å‡ºåœºæœºä¼šã€‚
p: &p
  type: http
  interval: *Time
  health-check:
    enable: true
    url: https://cp.cloudflare.com/generate_204
    interval: 300
  # proxy: è®¢é˜…æ›´æ–°
  # header: # å¦‚é‡è®¢é˜…åŠ è½½ä¸å‡ºæ¥è¯·åˆ‡æ¢ua
      # User-Agent:  # ä½¿ç”¨æ³¨é‡Šæ³•ç”±ä¸Šåˆ°ä¸‹ é»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä¸ª
        # - "ClashMetaForAndroid/2.11.2.Meta"
        # - "clash-verge/v2.2.3"
        # - "ClashforWindows/0.19.23"
        # - "clash.meta"
        # - "mihomo"




#ä»£ç†æä¾›è€…
proxy-providers:
  P1:
    type: file
    path: ./proxy_provider/proxy1.yaml
    override: 
      additional-prefix: "[YeS]"
  P2:
    type: file
    path: ./proxy_provider/p2.yaml
    override: 
      additional-prefix: "[Amy]"
  Local: 
    type: file
    path: ./proxy_provider/local.yaml
    override: 
      additional-prefix: "[Lo]"
  # P2: #æ”¯æŒå¤šè®¢é˜…çš„å‰ç»
    # <<: *p
    # url: ""
    # override:#è¦†å†™renameï¼ˆå‰ç¼€
      # additional-prefix: "[]"
  
  #é”šç‚¹ä½¿ç”¨ç¤ºä¾‹
  # 1.ä¸»è¦åœ°å€: # å¦‚é‡è®¢é˜…åŠ è½½ä¸å‡ºæ¥ï¼Œè¯·å°è¯•åˆ‡æ¢ua
    # <<: *p
    # override:è¦†å†™ï¼ˆå‰ç¼€
      # additional-prefix: "Mainï¼š"
    # path: ./proxies/1.ä¸»è¦åœ°å€.yaml
    # url: "æ­¤å¤„å¼•å…¥æ‚¨çš„Clashè®¢é˜…é“¾æ¥åœ°å€"


#ALL#æ³¨æ„åŒæ­¥æ·»åŠ ä»£ç†æä¾›è€…
All: &All
  type: select
  use:
  - P1
  - P2
  - Local


Selector: &Selector
  type: select
#ä½•æ„å‘³ã€‚ã€‚ã€‚









#å…¨å±€é…ç½®
mixed-port: 7890
redir-port: 9797
tproxy-port: 9898
mode: Rule
bind-address: '*'
ipv6: true
allow-lan: true
unified-delay: true #ç»Ÿä¸€å»¶è¿Ÿ
tcp-concurrent: true
log-level: silent # info / debug / warning / silent
find-process-mode: off # strict / always / off
# global-client-fingerprint: random  #å·²å¼ƒç”¨
external-controller: 0.0.0.0:9090
external-ui: ./dashboard
#external-ui-url: "https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip" #è¯·ç”¨zashboardè°¢è°¢
secret: "" #é¢æ¿å¯†ç ï¼Œæœ¬åœ°ä½¿ç”¨æ— éœ€ç†ä¼š



#è®°å¿†
profile:
  store-selected: true
  store-fake-ip: true
  smart-collector-size: 100





#å—…æ¢
sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
    TLS:
      ports: [443, 5228, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.v2ex.com"
  skip-domain: # å¦‚é‡éœ€å†…éƒ¨é€šä¿¡çš„åº”ç”¨è¯·æ”¾è¡Œè¯¥åŸŸå
    - "Mijia Cloud"



#tunç½‘å¡
tun:
  enable: true
  device: meta
  stack: gvisor
  dns-hijack: [any:53, tcp://any:53]
  udp-timeout: 300
  auto-route: true
  auto-redirect: false
  auto-detect-interface: true
  strict-route: false

# dns:
  # enable: true
  # ipv6: true
  # listen: 0.0.0.0:1053
  # enhanced-mode: fake-ip
  # fake-ip-range: 198.18.0.1/16
  # fake-ip-filter:
    # - "rule-set:Fake-IP-Filter"
  # proxy-server-nameserver:
    # - 1.1.1.1
    # - 8.8.8.8
  # nameserver-policy:
    # "rule-set:cn_domain":
      # - 119.29.29.29
  # nameserver:
    # - 1.1.1.1
    # - 8.8.8.8

#dnsé…ç½®  æ¨¡æ ·æœ‰ç‚¹æƒ¨æˆ‘æ‡’å¾—åˆ äº†
dns:
  enable: true # false
  ipv6: false
  cache-algorithm: arc
  prefer-h3: true
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
#  fake-ip-range6: fdfe:dcba:9876::1/64
  fake-ip-filter:
    - "RULE-SET:cn_domain"
    - "RULE-SET:Fake-IP-Filter"

# æ¢­å“ˆé˜¿é‡Œè°¢è°¢
  default-nameserver:
    - 223.5.5.5
    # - 119.29.29.29
    # - 1.0.0.1
    # - 8.8.8.8
  direct-nameserver:
    - https://223.5.5.5:443/dns-query   
    # - https://1.12.12.12/dns-query

  proxy-server-nameserver:
    - https://223.5.5.5:443/dns-query     
    # - https://1.12.12.12/dns-query
    # - https://doh.pub/dns-query

  nameserver-policy:

    "RULE-SET:Nikke":
      - "https://1.1.1.1/dns-query#Proxy"  #å¼ºåˆ¶ä½¿ç”¨[Proxy]æŸ¥è¯¢ï¼Œä¸æ˜¯æ³¨é‡Šå“¦

    "RULE-SET:cn_domain":
      - https://223.5.5.5:443/dns-query
      # - https://1.12.12.12/dns-query

  nameserver:
    - "https://1.1.1.1/dns-query#Proxy"
    # - https://8.8.8.8/dns-query
    # - "https://cloudflare-dns.com/dns-query#Proxy"
    # - https://dns.google/dns-query
# #    - https://223.5.5.5/dns-query    
#    - https://doh.pub/dns-query
    
# fake-ip-filter:
# - â€œrule-set:geolocation-!cn_domainâ€
# nameserver:
# - 223.5.5.5
# proxy-server-nameserver:
# - https://8.8.8.8/dns-query



    
    
    
    
    

#DNSåŠ«æŒ
proxies:
  - {name: DNS_Hijack, type: dns}







#ä»£ç†ç»„å¼€å§‹--- --- --- --- ---
proxy-groups:
  - name: Proxy
    type: select
    exclude-type: "dns"
    include-all: false    
    icon: https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Proxy.png
    proxies:
      - HKG
      - SGP
      - JPN
      - USA
      - All
      - Direct

  - name: HKG
    icon: "https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Hong_Kong.png"  
    filter: "^(?=.*(ğŸ‡­ğŸ‡°|æ¸¯|HK|hk|Hong Kong|HongKong|hongkong)).*$"
    <<: *All
    
  - name: SGP
    icon: "https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Singapore.png"
    filter: "^(?=.*(ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|å¡|ç‹®åŸ|SG|Singapore)).*$"
    <<: *All
    
  - name: JPN
    icon: "https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Japan.png"
    filter: "^(?=.*(ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|[^-]æ—¥|JP|Japan)).*$"
    <<: *All

  - name: USA
    icon: "https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/United_States.png"
    filter: "^(?=.*(ğŸ‡ºğŸ‡¸|ç¾|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|US|United States)).*$"
    <<: *All

  - name: All
    icon: "https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Available.png"
    type: select
    exclude-type: "dns"
    include-all: true

  - name: Telegram
    icon: "https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Telegram.png"
    proxies: [SGP,JPN,Proxy,All]
    include-all: false    
    <<: *Selector

  - name: AiService
    icon: "https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/AI.png"
    proxies: [SGP,Proxy,All]
    include-all: false    
    <<: *Selector

  - name: H@H
    icon: "https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Lab.png"
    proxies: [USA,Proxy,All]
    include-all: false    
    <<: *Selector
    
  - name: Direct
    type: select
    proxies: [DIRECT]
    exclude-type: "dns"
    icon: https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/China.png

  - name: Final
    type: select
    proxies: [Proxy,Direct]
    icon: https://ghfast.top/raw.githubusercontent.com/Koolson/Qure/refs/heads/master/IconSet/Color/Final.png
#ä»£ç†ç»„ç»“æŸ--- --- --- --- ---










#è§„åˆ™é›†anchor é…ç½®é”šç‚¹
rule-anchor:
  Local: &Local
    {type: file, behavior: classical, format: yaml}
  Classical: &Classical
    {type: http, behavior: classical, format: text, interval: *Time}
  IPCIDR: &IPCIDR
    {type: http, behavior: ipcidr, format: mrs, interval: *Time}
  Domain: &Domain
    {type: http, behavior: domain, format: mrs, interval: *Time}
  YAML: &YAML  
    {type: http, behavior: classical, format: yaml, interval: *Time}
  YAMLs: &YAMLs  
    {type: http, behavior: domain, format: yaml, interval: *Time}

#è§„åˆ™é›† ä½¿ç”¨anchorçš„é”šç‚¹
rule-providers:
  Fake-IP-Filter:
    <<: *Domain
    path: ./rule_provider/Fake-IP-Filter.mrs
    url: "https://v6.gh-proxy.com/https://github.com/DustinWin/ruleset_geodata/raw/refs/heads/mihomo-ruleset/fakeip-filter.mrs"
    proxy: DIRECT
  proxy_domain:
    <<: *Domain
    path: ./rule_provider/proxy_domain.mrs
    url: "https://ghfast.top/github.com/DustinWin/ruleset_geodata/raw/refs/heads/mihomo-ruleset/proxy.mrs"
    proxy: DIRECT
  cn_ip:
    <<: *IPCIDR
    url: "https://v6.gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/cn.mrs"
    proxy: DIRECT
  private_ip:
    <<: *IPCIDR
    path: ./rule_provider/private_ip.mrs
    url: "https://v6.gh-proxy.com/https://github.com/DustinWin/ruleset_geodata/raw/refs/heads/mihomo-ruleset/privateip.mrs"
    proxy: DIRECT
  cn_domain:
    <<: *Domain
    path: ./rule_provider/cn_domain.mrs
    url: "https://v6.gh-proxy.com/https://github.com/DustinWin/ruleset_geodata/raw/refs/heads/mihomo-ruleset/cn.mrs"
    proxy: DIRECT
  private_domain:
    <<: *Domain
    path: ./rule_provider/private_domain.mrs
    url: "https://v6.gh-proxy.com/https://github.com/DustinWin/ruleset_geodata/raw/refs/heads/mihomo-ruleset/private.mrs"
    proxy: DIRECT    
  OpenAi:
    <<: *Domain
    path: ./rules/OpenAI.mrs
    url: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/openai.mrs"
  Gemini:
    <<: *YAML
    path: ./rules/Gemini.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.yaml"
  Telegram_Domain:
    <<: *Domain
    path: ./rules/Telegram.mrs
    url: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/telegram.mrs"
  Telegram_IP:
    <<: *IPCIDR
    path: ./rules/Telegram_IP.mrs
    url: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo-lite/geoip/telegram.mrs"
  Ehentai:
    <<: *Domain
    path: ./rules/ehentai.mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo-lite/geosite/ehentai.mrs"  
  Google:
    <<: *Domain
    path: ./rules/google.mrs
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo-lite/geosite/google.mrs"
  Nikke:
    <<: *Local
    path: ./rules/nikke.yaml
#    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/Nikke/Nikke.yaml"







#è§„åˆ™  
rules:
  - DST-PORT,53,DNS_Hijack
  
  - RULE-SET,Google,AiService #æˆ‘æ•…æ„çš„ å•ç»™å¥¹å¼€ä¸ªç»„å¾ˆéº»çƒ¦è€Œä¸”å’Œgeminiæš§æ˜§ä¸æ¸… éƒ½èµ°sgå¥½äº†æ²¡å•¥æ¯›ç—…
  - RULE-SET,Telegram_Domain,Telegram
  - RULE-SET,Telegram_IP,Telegram
  - RULE-SET,OpenAi,AiService
  - RULE-SET,Gemini,AiService
  - RULE-SET,Ehentai,H@H
  
  - RULE-SET,proxy_domain,Proxy

  - RULE-SET,Nikke,Proxy
  
  - RULE-SET,cn_domain,Direct
  - RULE-SET,cn_ip,Direct

  - RULE-SET,private_domain,Direct
  - RULE-SET,private_ip,Direct
  
# - OR,((RULE-SET,cn_ip),(RULE-SET,cn_domain),(RULE-SET,private_ip),(RULE-SET,private_domain)),Direct  #ç”¨è¿™ä¸ªçœ‹ä¸æ‡‚log

  - MATCH,Final